spring:
  application:
    name: gateway-service
  main:
    web-application-type: reactive
  cloud:
    gateway:
      discovery:
        locator:
          enabled: true
          lower-case-service-id: true
      routes:
        - id: sop-workflow-service
          uri: lb://sop-workflow-service
          predicates:
            - Path=/workflow/**
          filters:
            - RewritePath=/workflow/v3/api-docs, /v3/api-docs
            - RewritePath=/workflow/swagger-ui/(?<segment>.*), /swagger-ui/${segment}

        - id: user-management-service
          uri: lb://user-management-service
          predicates:
            - Path=/users/**
          filters:
            - RewritePath=/users/v3/api-docs, /v3/api-docs
            - RewritePath=/users/swagger-ui/(?<segment>.*), /swagger-ui/${segment}

        - id: analytics-insights-service
          uri: lb://analytics-insights-service
          predicates:
            - Path=/analytics/**
            - Method=GET,POST,PUT,DELETE,OPTIONS
          filters:
            - RewritePath=/analytics/v3/api-docs, /v3/api-docs
            - RewritePath=/analytics/swagger-ui/(?<segment>.*), /swagger-ui/${segment}

        - id: audit-compliance-tracking-service
          uri: lb://audit-compliance-tracking-service
          predicates:
            - Path=/audit/**
          filters:
            - RewritePath=/audit/v3/api-docs, /v3/api-docs
            - RewritePath=/audit/swagger-ui/(?<segment>.*), /swagger-ui/${segment}

        - id: compliance-reporting-service
          uri: lb://compliance-reporting-service
          predicates:
            - Path=/compliance/**
          filters:
            - RewritePath=/compliance/v3/api-docs, /v3/api-docs
            - RewritePath=/compliance/swagger-ui/(?<segment>.*), /swagger-ui/${segment}

        - id: discovery-service
          uri: lb://discovery-service
          predicates:
            - Path=/discovery/**
          filters:
            - RewritePath=/discovery/v3/api-docs, /v3/api-docs
            - RewritePath=/discovery/swagger-ui/(?<segment>.*), /swagger-ui/${segment}

        - id: notification-service
          uri: lb://notification-service
          predicates:
            - Path=/notifications/**
          filters:
            - RewritePath=/notifications/v3/api-docs, /v3/api-docs
            - RewritePath=/notifications/swagger-ui/(?<segment>.*), /swagger-ui/${segment}

        - id: role-access-control-service
          uri: lb://role-access-control-service
          predicates:
            - Path=/access/**
          filters:
            - RewritePath=/access/v3/api-docs, /v3/api-docs
            - RewritePath=/access/swagger-ui/(?<segment>.*), /swagger-ui/${segment}

        - id: sop-content-service
          uri: lb://sop-content-service
          predicates:
            - Path=/content/**
          filters:
            - RewritePath=/content/v3/api-docs, /v3/api-docs
            - RewritePath=/content/swagger-ui/(?<segment>.*), /swagger-ui/${segment}

        - id: sop-recommendation-service
          uri: lb://sop-recommendation-service
          predicates:
            - Path=/recommendations/**
          filters:
            - RewritePath=/recommendations/v3/api-docs, /v3/api-docs
            - RewritePath=/recommendations/swagger-ui/(?<segment>.*), /swagger-ui/${segment}

        - id: version-control-service
          uri: lb://version-control-service
          predicates:
            - Path=/versions/**
          filters:
            - RewritePath=/versions/v3/api-docs, /v3/api-docs
            - RewritePath=/versions/swagger-ui/(?<segment>.*), /swagger-ui/${segment}

      globalcors:
        corsConfigurations:
          '[/**]':
            allowedOriginPatterns: '*'
            allowedMethods:
              - GET
              - POST
              - PUT
              - DELETE
              - PATCH
              - OPTIONS
            allowedHeaders: '*'
            allowCredentials: true
            maxAge: 3600

      httpclient:
        connect-timeout: 30000
        response-timeout: 30000

      x-forwarded:
        enabled: true

      default-filters:
        - DedupeResponseHeader=Access-Control-Allow-Credentials Access-Control-Allow-Origin
        - AddResponseHeader=Access-Control-Allow-Origin, *

server:
  port: 8084

eureka:
  client:
    serviceUrl:
      defaultZone: http://eureka:password@localhost:8761/eureka/
  instance:
    preferIpAddress: true
    hostname: localhost

springdoc:
  swagger-ui:
    path: /swagger-ui.html
    config-url: /v3/api-docs/swagger-config
    url: /v3/api-docs
    disable-swagger-default-url: true
    display-request-duration: true
    operations-sorter: alpha
    tags-sorter: alpha
    doc-expansion: none
    filter: true
    show-extensions: true
    show-common-extensions: true
    urls:
      - name: SOP Workflow Service
        url: /workflow/v3/api-docs
      - name: User Management Service
        url: /users/v3/api-docs
      - name: Analytics Insights Service
        url: /analytics/v3/api-docs
      - name: Audit Compliance Tracking Service
        url: /audit/v3/api-docs
      - name: Compliance Reporting Service
        url: /compliance/v3/api-docs
      - name: Discovery Service
        url: /discovery/v3/api-docs
      - name: Notification Service
        url: /notifications/v3/api-docs
      - name: Role Access Control Service
        url: /access/v3/api-docs
      - name: SOP Content Service
        url: /content/v3/api-docs
      - name: SOP Recommendation Service
        url: /recommendations/v3/api-docs
      - name: Version Control Service
        url: /versions/v3/api-docs
  api-docs:
    path: /v3/api-docs

logging:
  level:
    org.springframework.cloud.gateway: INFO
    reactor.netty: INFO
  pattern:
    console: '%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n'